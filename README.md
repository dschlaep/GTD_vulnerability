# Code for the analysis of our manuscript _XXX_

Code by Daniel Schlaepfer

Our simulation experiment was run with SOILWAT v0.1.0-gtd (available from our github repository as [R package](https://github.com/Burke-Lauenroth-Lab/Rsoilwat)). We used a [wrapper R script](https://github.com/Burke-Lauenroth-Lab/SoilWat_R_Wrapper) v0.1.0-gtd to organize simulation runs and output as SQLite databases. The relevant simulation output will be made available at Dryad XXX.


The analysis was carried out with 15 R scripts:

* _2_GTD_GCM_Comparison_v1.R_: Comparison of mean monthly soil moisture patterns between SOILWAT and GCMs
* _5_Database_Functions.R_: Functions to navigate a SQL-database produced by the wrapper script (available from our [wrapper R script repository](https://github.com/Burke-Lauenroth-Lab/SoilWat_R_Wrapper))
* _5a1_GTD_Prj03v4_Helper.R_: Collection of settings, functions, and (pre-extracted) data loading used by the other script files
* _5a2_GTD_Prj03v4_Extract_subsetPrj06.R_: Extract results from SQL-database
* _5a3_GTD_Prj03v4_PreCalculations.R_: Calculate shifts, masks, and attribution
* _5b_GTD_Prj03v4_Analysis_StudyAreaExtent_v2.R_: Tabulate and map gtd extents
* _5c_GTD_Prj03v4_Analysis_MapsMain.R_: Map median GTD extent/values
* _5d_GTD_Prj03v4_Analysis_MapsDetailed.R_: Map median and range of GTD extent/values
* _5e_GTD_Prj03v2_Analysis_Scatterplots.R_: Plot scatters between response variables
* _5f_GTD_Prj03v4_Analysis_TablesSummary.R_: Format tables for manuscript
* _5g_GTD_Prj03v4_Analysis_VariationPartition.R_: Partitioning of variation
* _5i_GTD_Prj03v4_Analysis_PairwiseCorrelations.R_: Calculate pairwise correlation coefficients
* _5j_GTD_Prj03v4_Analysis_ChangeDensities.R_: Plot change in response per region
* _5k_GTD_Prj03v4_Analysis_GeographicCorrelations.R_: Tabulate and plot scatters and fits
* _5l_GTD_Prj03v4_Analysis_ArealPosNegResponses.R_: Determine areas with pos/neg response


Code that produced figures and supplementary materials:

* Figure 1 (Current and future distribution of temperate drylands under RCP8.5)
	- Script: _5b_GTD_Prj03v4_Analysis_StudyAreaExtent_v2.R_
	- Options: `map_inset_version == "v3"`
	- Output: 6_Results/1_StudyArea/Maps/AgreementMap_RCP85_v3.pdf

* Figure 2 (Duration of continuous, growing season ecological drought)
	- Script: _5j_GTD_Prj03v4_Analysis_ChangeDensities.R_
	- Options: `fig_version == 7 && add_bars_extent == FALSE`
	- Output: 6_Results/9_ChangePlots_v4/Fig_MeanDensities_resResponse2_RCP85_v7f.pdf

* Figure 3 (Climate-driven changes in the proportion of transpiration derived from deep soil moisture (> 20 cm depth))
	- Script: _5c_GTD_Prj03v4_Analysis_MapsMain.R_
    - Output: 6_Results/2_MainMaps_r3/resResponse2/MainMap_TranspirationBottomToTranspirationTotal_fraction_RCP85_rank8_AbsoluteChange.pdf

* Figure 4 (Relationship between current values of the proportion of transpiration derived from deep soil moisture (> 20 cm depth) and its response under RCP8.5 for 2070-2100)
	- Script: _5k_GTD_Prj03v4_Analysis_GeographicCorrelations.R_
    - Output: 6_Results/10_CorrelationTables_Geographic_v3/Figures/Fig_CorrelationWithCurrent_RCP85_TranspirationBottomToTranspirationTotal_fraction_AbsoluteChange_by_TranspirationBottomToTranspirationTotal_fraction_v2.pdf


* Supplementary Figure 1 (Current and future distribution of temperate drylands under RCP4.5)
	- Script: _5b_GTD_Prj03v4_Analysis_StudyAreaExtent_v2.R_
	- Options: `map_inset_version == "v3"`
	- Output: 6_Results/1_StudyArea/Maps/AgreementMap_RCP45_v3.pdf
	
* Supplementary Figure 2 (Current mean annual precipitation (MAP, mm yr-1) and relative changes under future conditions)
	- Script: _5d_GTD_Prj03v4_Analysis_MapsDetailed.R_
	- Output: 6_Results/3_DetailedMaps/resClimate2/Map_MAP_mm_mean_RelativeChange.pdf

* Supplementary Figure 3 (Current mean annual temperature (MAT, C) and absolute changes under future conditions)
	- Script: _5d_GTD_Prj03v4_Analysis_MapsDetailed.R_
	- Output: 6_Results/3_DetailedMaps/resClimate2/Map_MAT_C_mean_AbsoluteChange.pdf

* Supplementary Figure 4 (Current mean annual potential evapotranspiration (PET, mm yr-1) and relative changes under future conditions)
	- Script: _5d_GTD_Prj03v4_Analysis_MapsDetailed.R_
	- Output: 6_Results/3_DetailedMaps/resClimate2/Map_PET_mm_mean_RelativeChange.pdf

* Supplementary Figure 5 (Current mean overlap of wet/warm-season (correlation between monthly precipitation and monthly mean temperature) and absolute changes under future conditions)
	- Script: _5d_GTD_Prj03v4_Analysis_MapsDetailed.R_
	- Output: 6_Results/3_DetailedMaps/resClimate2/Map_Seasonality_monthlyTandPPT_PearsonCor_mean_AbsoluteChange.pdf

* Supplementary Figure 6 (Current mean winter precipitation (mm) and absolute changes under future conditions)
	- Script: _5d_GTD_Prj03v4_Analysis_MapsDetailed.R_
	- Output: 6_Results/3_DetailedMaps/resPPT2/Map_Precip_winter_mm_mean_AbsoluteChange/pdf

* Supplementary Figure 7 (Current and future annual transpiration (mm) derived from shallow soil moisture (0â€“20 cm depth) and absolute response under future conditions)
	- Script: _5d_GTD_Prj03v4_Analysis_MapsDetailed.R_
	- Output: 6_Results/3_DetailedMaps/resTransp2/Map_Transpiration_topLayers_mm_mean_AbsoluteChange.pdf
	
* Supplementary Figure 8 (Current and future annual transpiration (mm) derived from deep soil moisture (>20 cm depth) and absolute response under future conditions)
	- Script: _5d_GTD_Prj03v4_Analysis_MapsDetailed.R_
	- Output: 6_Results/3_DetailedMaps/resTransp2/Map_Transpiration_bottomLayers_mm_mean_AbsoluteChange.pdf

* Supplementary Figure 9 (Current proportion of transpiration derived from deep soil moisture (> 20 cm depth) and absolute change in the proportion under future conditions)
	- Script: _5d_GTD_Prj03v4_Analysis_MapsDetailed.R_
	- Output: 6_Results/3_DetailedMaps/resTransp2/Map_TranspirationBottomToTranspirationTotal_fraction_mean_AbsoluteChange.pdf

* Supplementary Figure 10 (Comparison of mean monthly soil moisture patterns between SOILWAT and GCMs)
	- Script: _2_GTD_GCM_Comparison_v1.R_
	- Options: `version == "v1"`
	- Output: 6_Results/1_Comparison_with_GCM_SoilMoisture/ComparisonGrids_mrso_meanmonthly_Duveillers_lambda_v1_trichrome.pdf

* Supplementary Table 1 (Distribution of global temperate drylands)
	- Script: _5b_GTD_Prj03v4_Analysis_StudyAreaExtent_v2.R_
	- Output: 6_Results/1_StudyArea/Tables/Table_S3_Extent of global temperate drylands.csv

* Supplementary Table 2 (Areal change of global temperate drylands)
	- Script: _5b_GTD_Prj03v4_Analysis_StudyAreaExtent_v2.R_
	- Output: 6_Results/1_StudyArea/Tables/Table_S4_Change of global temperate dryland area relative to current geographic extent_v2.csv

* Supplementary Table 3 (Factor attribution to shifts of temperate dryland distribution)
	- Script: _5b_GTD_Prj03v4_Analysis_StudyAreaExtent_v2.R_
	- Output: 6_Results/1_StudyArea/Tables/Table_S5_Relative attribution to geographic shifts_v2.csv

* Supplementary Table 4 (Simulation responses: median values of response variables under current and future climate conditions for the end of the 21st century and scenario RCP8.5 for shifting zones of each region)
	- Script: _5f_GTD_Prj03v4_Analysis_TablesSummary.R_
	- Output: 6_Results/5_Tables_v4/resResponse2/Table_resResponse2_Mean_shifts.csv
	- Output: 6_Results/5_Tables_v4/resTransp2/Table_resTransp2_Mean_shifts.csv

* Supplementary Table 5 (Simulation responses: median values of response variables under current and future climate conditions for the end of the 21st century and scenario RCP4.5 for shifting zones of each region)
	- Script: _5f_GTD_Prj03v4_Analysis_TablesSummary.R_
	- Output: 6_Results/5_Tables_v4/resResponse2/Table_resResponse2_Mean_shifts.csv
	- Output: 6_Results/5_Tables_v4/resTransp2/Table_resTransp2_Mean_shifts.csv

* Supplementary Table 6 (Median values of climate drivers under current and future climate conditions for the end of the 21st century and scenario RCP8.5 for shifting zones of each region)
	- Script: _5f_GTD_Prj03v4_Analysis_TablesSummary.R_
	- Output: 6_Results/5_Tables_v4/resClimate2/Table_resClimate2_Mean_shifts.csv
	- Output: 6_Results/5_Tables_v4/resPPT2/Table_resPPT2_Mean_shifts.csv

* Supplementary Table 7 (Median values of climate drivers under current and future climate conditions for the end of the 21st century and scenario RCP4.5 for shifting zones of each region)
	- Script: _5f_GTD_Prj03v4_Analysis_TablesSummary.R_
	- Output: 6_Results/5_Tables_v4/resClimate2/Table_resClimate2_Mean_shifts.csv
	- Output: 6_Results/5_Tables_v4/resPPT2/Table_resPPT2_Mean_shifts.csv

* Supplementary Table 8 (GCM used with our simulations)
	- No script

* Supplementary Table 9 (Variation partitioning)
	- Script: _5g_GTD_Prj03v4_Analysis_VariationPartition.R_
	- Options: `do_attempt[[7]] == TRUE && do_compare_methods == FALSE`
	- Output: 6_Results/6_VariationPartitioning/Tables_Aggregated/Table_VariationPartitioning_Means_Climate_Mean.csv
	- Output: 6_Results/6_VariationPartitioning/Tables_Aggregated/Table_VariationPartitioning_Means_Climate_AbsoluteChange.csv
	- Output: 6_Results/6_VariationPartitioning/Tables_Aggregated/Table_VariationPartitioning_Means_Response_Mean.csv
	- Output: 6_Results/6_VariationPartitioning/Tables_Aggregated/Table_VariationPartitioning_Means_Response_AbsoluteChange.csv

* Supplementary Table 10 (Comparison of mean monthly soil moisture patterns between SOILWAT and GCMs)
	- Script: _2_GTD_GCM_Comparison_v1.R_
	- Options: `version == "v1"`
	- Output: 6_Results/1_Comparison_with_GCM_SoilMoisture/ComparisonTable_mrso_meanmonthly_v1.csv
